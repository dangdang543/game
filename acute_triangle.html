<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>매트리킹: 6x6 예각삼각형 게임</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; text-align: center; background-color: #f4f7f6; margin-top: 30px; }
        #game-info { margin-bottom: 20px; padding: 15px; background: white; border-radius: 12px; display: inline-block; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .score-board { font-size: 1.4rem; font-weight: bold; margin-bottom: 10px; }
        .p1 { color: #e74c3c; } .p2 { color: #3498db; }
        canvas { background: white; border: 3px solid #2c3e50; border-radius: 10px; cursor: pointer; box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        #msg { height: 35px; margin-top: 15px; font-size: 1.1rem; font-weight: bold; color: #2c3e50; }
        .controls { margin-top: 25px; }
        button { padding: 12px 25px; font-size: 1rem; cursor: pointer; background: #2c3e50; color: white; border: none; border-radius: 6px; transition: 0.2s; }
        button:hover { background: #34495e; }
    </style>
</head>
<body>
    <h1>6x6 예각삼각형 찾기</h1>
    
    <div id="game-info">
        <div class="score-board">
            <span class="p1">플레이어 1: <span id="p1-score">0</span></span> &nbsp;&nbsp;|&nbsp;&nbsp; 
            <span class="p2">플레이어 2: <span id="p2-score">0</span></span>
        </div>
        <div id="turn-display" style="font-size: 1.1rem; color: #e74c3c; font-weight: bold;">플레이어 1(빨강)의 차례</div>
        <div id="msg">점 3개를 선택하여 예각삼각형을 만드세요!</div>
    </div>

    <div>
        <canvas id="gameCanvas" width="500" height="500"></canvas>
    </div>

    <div class="controls">
        <button onclick="resetGame()">게임 다시 시작</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const GRID_SIZE = 6;
        const PADDING = 60;
        const SPACING = (canvas.width - PADDING * 2) / (GRID_SIZE - 1);
        
        let selectedPoints = []; 
        let usedPoints = [];     // {i, j, player} 객체로 저장하여 색상 구분
        let currentPlayer = 1;
        let scores = { 1: 0, 2: 0 };

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const x = PADDING + i * SPACING;
                    const y = PADDING + j * SPACING;
                    
                    // 해당 점이 이미 사용되었는지 확인 및 누가 사용했는지 확인
                    const usedInfo = usedPoints.find(p => p.i === i && p.j === j);
                    const isSelected = selectedPoints.some(p => p.i === i && p.j === j);

                    ctx.beginPath();
                    if (usedInfo) {
                        // 사용된 점: 플레이어 색상에 따라 굵게 표시
                        ctx.arc(x, y, 11, 0, Math.PI * 2);
                        ctx.fillStyle = usedInfo.player === 1 ? "#e74c3c" : "#3498db"; 
                    } else if (isSelected) {
                        // 현재 선택 중인 점: 녹색 하이라이트 (선택 중임을 알림)
                        ctx.arc(x, y, 8, 0, Math.PI * 2);
                        ctx.fillStyle = "#2ecc71";
                    } else {
                        // 일반 빈 점
                        ctx.arc(x, y, 5, 0, Math.PI * 2);
                        ctx.fillStyle = "#ccc";
                    }
                    ctx.fill();
                    ctx.closePath();
                }
            }
        }

        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const x = PADDING + i * SPACING;
                    const y = PADDING + j * SPACING;
                    
                    if (Math.hypot(x - mouseX, y - mouseY) < 18) {
                        if (usedPoints.some(p => p.i === i && p.j === j)) {
                            document.getElementById('msg').innerText = "이미 누군가 사용한 점입니다!";
                            return;
                        }

                        const alreadySelected = selectedPoints.findIndex(p => p.i === i && p.j === j);
                        if (alreadySelected > -1) {
                            selectedPoints.splice(alreadySelected, 1);
                        } else if (selectedPoints.length < 3) {
                            selectedPoints.push({x, y, i, j});
                        }

                        if (selectedPoints.length === 3) {
                            validateTriangle();
                        }
                        draw();
                        return;
                    }
                }
            }
        });

        function validateTriangle() {
            const [p1, p2, p3] = selectedPoints;
            const area = Math.abs((p1.i*(p2.j-p3.j) + p2.i*(p3.j-p1.j) + p3.i*(p1.j-p2.j))/2);
            
            if (area === 0) {
                document.getElementById('msg').innerText = "일직선은 삼각형이 아닙니다!";
                selectedPoints = [];
                return;
            }

            const d12 = Math.pow(p1.i - p2.i, 2) + Math.pow(p1.j - p2.j, 2);
            const d23 = Math.pow(p2.i - p3.i, 2) + Math.pow(p2.j - p3.j, 2);
            const d31 = Math.pow(p3.i - p1.i, 2) + Math.pow(p3.j - p1.j, 2);
            const sides = [d12, d23, d31].sort((a, b) => a - b);
            
            if (sides[0] + sides[1] > sides[2]) {
                scores[currentPlayer]++;
                document.getElementById('msg').innerText = `성공! 플레이어 ${currentPlayer} 예각삼각형 확보!`;
                // 사용된 점 리스트에 플레이어 정보와 함께 추가
                selectedPoints.forEach(p => {
                    usedPoints.push({i: p.i, j: p.j, player: currentPlayer});
                });
            } else {
                const type = (sides[0] + sides[1] === sides[2]) ? "직각" : "둔각";
                document.getElementById('msg').innerText = `${type}삼각형은 점수를 얻을 수 없습니다.`;
            }

            updateUI();
            currentPlayer = currentPlayer === 1 ? 2 : 1;
            selectedPoints = [];
            const turnEl = document.getElementById('turn-display');
            turnEl.innerText = `플레이어 ${currentPlayer}(${currentPlayer === 1 ? '빨강' : '파랑'})의 차례`;
            turnEl.style.color = currentPlayer === 1 ? '#e74c3c' : '#3498db';
        }

        function updateUI() {
            document.getElementById('p1-score').innerText = scores[1];
            document.getElementById('p2-score').innerText = scores[2];
        }

        function resetGame() {
            selectedPoints = [];
            usedPoints = [];
            scores = { 1: 0, 2: 0 };
            currentPlayer = 1;
            document.getElementById('msg').innerText = "점 3개를 선택하세요!";
            document.getElementById('turn-display').innerText = `플레이어 1(빨강)의 차례`;
            document.getElementById('turn-display').style.color = '#e74c3c';
            updateUI();
            draw();
        }

        draw();
    </script>
</body>
</html>