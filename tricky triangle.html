<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>삼각형 페그 솔리테어</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #2c3e50; color: white; margin-top: 20px; touch-action: manipulation; }
        .board-container { position: relative; width: 320px; height: 300px; margin-top: 20px; }
        .hole { 
            position: absolute; width: 50px; height: 50px; 
            background-color: #1a252f; border: 2px solid #162129; 
            border-radius: 50%; cursor: pointer; transform: translate(-50%, -50%);
            display: flex; justify-content: center; align-items: center;
        }
        .peg { 
            width: 38px; height: 38px; 
            background: radial-gradient(circle at 30% 30%, #3498db, #2980b9); 
            border-radius: 50%; box-shadow: 0 3px 6px rgba(0,0,0,0.4); pointer-events: none; 
        }
        .selected { border: 3px solid #e74c3c; box-shadow: 0 0 15px #e74c3c; transform: scale(1.1); }
        #status { margin-top: 30px; font-size: 1.1em; font-weight: bold; min-height: 1.5em; text-align: center; }
        .controls { margin-top: 20px; display: flex; gap: 10px; }
        button { padding: 12px 20px; border: none; color: white; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: bold; }
        .undo-btn { background: #9b59b6; }
        .undo-btn:disabled { background: #7f8c8d; cursor: default; }
        .reset-btn { background: #e67e22; }
    </style>
</head>
<body>
    <h1>삼각형 페그 솔리테어</h1>
    <div id="status">맨 위 칸만 비어있습니다. 말을 선택하세요!</div>
    
    <div class="board-container" id="board"></div>
    
    <div class="controls">
        <button class="undo-btn" id="undoBtn" onclick="undo()" disabled>뒤로가기</button>
        <button class="reset-btn" onclick="resetGame()">처음부터</button>
    </div>

    <script>
        // 15개 구멍의 좌표 정의 (삼각형 모양)
        const positions = [
            {r:0, c:0, x:160, y:30},  // 0
            {r:1, c:0, x:130, y:85},  {r:1, c:1, x:190, y:85}, // 1, 2
            {r:2, c:0, x:100, y:140}, {r:2, c:1, x:160, y:140}, {r:2, c:2, x:220, y:140}, // 3, 4, 5
            {r:3, c:0, x:70, y:195},  {r:3, c:1, x:130, y:195}, {r:3, c:2, x:190, y:195}, {r:3, c:3, x:250, y:195}, // 6, 7, 8, 9
            {r:4, c:0, x:40, y:250},  {r:4, c:1, x:100, y:250}, {r:4, c:2, x:160, y:250}, {r:4, c:3, x:220, y:250}, {r:4, c:4, x:280, y:250} // 10, 11, 12, 13, 14
        ];

        // 가능한 점프 규칙 (from, over, to)
        const moves = [
            [0,1,3], [0,2,5], [1,3,6], [1,4,8], [2,4,7], [2,5,9],
            [3,1,0], [3,4,5], [3,6,10], [3,7,12], [4,7,11], [4,8,13],
            [5,2,0], [5,4,3], [5,8,12], [5,9,14], [6,3,1], [6,7,8],
            [7,4,2], [7,8,9], [8,4,1], [8,7,6], [9,5,2], [9,8,7],
            [10,6,3], [10,11,12], [11,7,4], [11,12,13], [12,7,3], [12,8,5], [12,11,10], [12,13,14],
            [13,8,4], [13,12,11], [14,9,5], [14,13,12]
        ];

        let boardState = []; // 1: 말 있음, 0: 빈 칸
        let history = [];
        let selectedIndex = null;

        function resetGame() {
            // 맨 위(0번)만 비어있고 나머지는 말이 찬 상태로 시작
            boardState = [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1];
            history = [];
            selectedIndex = null;
            updateStatus("게임을 시작합니다!");
            render();
        }

        function render() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            
            positions.forEach((pos, i) => {
                const hole = document.createElement('div');
                hole.className = 'hole';
                hole.style.left = pos.x + 'px';
                hole.style.top = pos.y + 'px';
                hole.onclick = () => handleClick(i);
                
                if (boardState[i] === 1) {
                    const peg = document.createElement('div');
                    peg.className = 'peg';
                    if (selectedIndex === i) peg.classList.add('selected');
                    hole.appendChild(peg);
                }
                board.appendChild(hole);
            });
            document.getElementById('undoBtn').disabled = history.length === 0;
        }

        function handleClick(i) {
            if (boardState[i] === 1) {
                selectedIndex = i;
                updateStatus("이동할 빈 칸을 누르세요.");
            } else if (boardState[i] === 0 && selectedIndex !== null) {
                const move = moves.find(m => m[0] === selectedIndex && m[2] === i);
                if (move && boardState[move[1]] === 1) {
                    history.push(JSON.stringify(boardState));
                    boardState[move[0]] = 0;
                    boardState[move[1]] = 0;
                    boardState[move[2]] = 1;
                    selectedIndex = null;
                    updateStatus("점프 성공!");
                    checkGame();
                } else {
                    selectedIndex = null;
                    updateStatus("거기로는 점프할 수 없어요.");
                }
            }
            render();
        }

        function undo() {
            if (history.length > 0) {
                boardState = JSON.parse(history.pop());
                selectedIndex = null;
                updateStatus("한 수 되돌렸습니다.");
                render();
            }
        }

        function checkGame() {
            const count = boardState.filter(v => v === 1).length;
            if (count === 1) updateStatus("축하합니다! 천재시네요!");
        }

        function updateStatus(msg) {
            document.getElementById('status').innerText = msg;
        }

        resetGame();
    </script>
</body>
</html>