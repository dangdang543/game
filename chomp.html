<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì´ˆì½œë¦¿ ì´˜í”„ - ëª¨ë°”ì¼ í”„ë¡œ ë²„ì „</title>
    <style>
        /* ëª¨ë°”ì¼ ì „ì²´ ë°°ê²½ ë° í°íŠ¸ ì„¤ì • */
        body { 
            font-family: 'Malgun Gothic', sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            background-color: #f5f0e6; 
            margin: 0;
            padding: 20px 10px;
            touch-action: manipulation; /* ë”ë¸”íƒ­ í™•ëŒ€ ë°©ì§€ */
        }
        
        h1 { color: #5d4037; font-size: 2rem; margin-bottom: 20px; }
        
        /* ì„¤ì •ì°½ ë° ê²Œì„ì°½ í¬ê¸° ëŒ€í­ í™•ëŒ€ */
        #menu, #game-area { 
            background: white; 
            padding: 30px 20px; 
            border-radius: 15px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.1); 
            text-align: center;
            width: 100%;
            max-width: 450px; /* ëª¨ë°”ì¼ í­ì— ë§ì¶¤ */
            box-sizing: border-box;
        }

        /* í¬ê¸° ì„¤ì • í•­ëª© ë””ìì¸ ê°•í™” */
        .setting-group { margin-bottom: 25px; }
        .setting-group label { 
            display: block; 
            font-size: 1.4rem; 
            font-weight: bold; 
            color: #5d4037; 
            margin-bottom: 15px; 
        }

        /* ì…ë ¥ì°½(Input) í¬ê¸° í‚¤ìš°ê¸° */
        input[type="number"] {
            width: 80px;
            height: 50px;
            font-size: 1.5rem;
            border: 2px solid #8d6e63;
            border-radius: 10px;
            text-align: center;
            color: #5d4037;
            background-color: #fff;
        }

        #status { 
            margin: 20px 0; 
            font-size: 1.4rem; 
            font-weight: bold; 
            color: #d32f2f; 
            min-height: 1.6em;
        }

        /* ì´ˆì½œë¦¿ íŒ ì»¨í…Œì´ë„ˆ */
        #grid-container {
            display: inline-block;
            background-color: #3e2723;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 20px;
            max-width: 100%;
            overflow-x: auto; /* í™”ë©´ë³´ë‹¤ í´ ê²½ìš° ìŠ¤í¬ë¡¤ */
        }

        #grid { 
            display: grid; 
            gap: 6px; 
            margin: 0 auto;
        }

        /* ì´ˆì½œë¦¿ ì¡°ê° í¬ê¸° í™•ëŒ€ (í„°ì¹˜ ìµœì í™”) */
        .cell { 
            width: 55px; 
            height: 55px; 
            background-color: #8d6e63; 
            border-radius: 5px; 
            cursor: pointer; 
            transition: opacity 0.3s ease;
            -webkit-tap-highlight-color: transparent; /* í„°ì¹˜ ì‹œ íŒŒë€ ë°•ìŠ¤ ì œê±° */
        }

        .cell.eaten { 
            opacity: 0; 
            pointer-events: none; 
        }

        .cell.poison { background-color: #d32f2f; position: relative; }
        .cell.poison::after { 
            content: "â˜ ï¸"; 
            position: absolute; 
            top: 50%; left: 50%; 
            transform: translate(-50%, -50%); 
            font-size: 1.5rem; 
        }
        
        /* ë²„íŠ¼ í¬ê¸° í™•ëŒ€ ë° ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ë§ */
        button { 
            width: 100%;
            padding: 15px; 
            font-size: 1.2rem; 
            font-weight: bold;
            background-color: #5d4037; 
            color: white; 
            border: none; 
            border-radius: 12px; 
            cursor: pointer; 
            margin: 10px 0;
            transition: background 0.2s;
        }
        button:active { background-color: #3e2723; transform: scale(0.98); }
        .hidden { display: none; }

        @media (max-width: 400px) {
            .cell { width: 45px; height: 45px; } /* ì•„ì£¼ ì‘ì€ í™”ë©´ ëŒ€ì‘ */
        }
    </style>
</head>
<body>

    <h1>Chomp Mobile</h1>

    <div id="menu">
        <div class="setting-group">
            <label>ğŸ« ì´ˆì½œë¦¿ íŒ í¬ê¸° ì„¤ì •</label>
            <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
                <input type="number" id="rows" value="4" min="2" max="6">
                <span style="font-size: 1.5rem; font-weight: bold;">X</span>
                <input type="number" id="cols" value="5" min="2" max="6">
            </div>
            <p style="color: #888; margin-top: 10px;">(ì¶”ì²œ: 6x6 ì´í•˜)</p>
        </div>
        
        <button onclick="setupGame('PVP')">ì‚¬ëŒ vs ì‚¬ëŒ</button>
        <button onclick="setupGame('PVC')">ì»´í“¨í„°ì™€ ëŒ€ê²° </button>
    </div>

    <div id="game-area" class="hidden">
        <div id="status"></div>
        <div id="grid-container">
            <div id="grid"></div>
        </div>
        <button onclick="backToMenu()" style="background-color: #8d6e63;">ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <script>
        let ROWS, COLS, currentPlayer, gameOver, gameMode;
        let memo = new Map();

        const gridElement = document.getElementById('grid');
        const statusElement = document.getElementById('status');
        const menuElement = document.getElementById('menu');
        const gameArea = document.getElementById('game-area');

        function setupGame(mode) {
            ROWS = parseInt(document.getElementById('rows').value);
            COLS = parseInt(document.getElementById('cols').value);
            gameMode = mode;
            currentPlayer = 1;
            gameOver = false;
            memo.clear();

            // ì…€ í¬ê¸° 55px + ê°„ê²© 6px ê¸°ì¤€ ê³ ì •
            const cellSize = (window.innerWidth < 400) ? 45 : 55;
            gridElement.style.gridTemplateColumns = `repeat(${COLS}, ${cellSize}px)`;
            gridElement.style.width = `${COLS * cellSize + (COLS - 1) * 6}px`;
            
            menuElement.classList.add('hidden');
            gameArea.classList.remove('hidden');
            statusElement.innerText = "ë‹¹ì‹ ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤!";
            createBoard();
        }

        function createBoard() {
            gridElement.innerHTML = '';
            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell' + (r === ROWS - 1 && c === 0 ? ' poison' : '');
                    cell.dataset.row = r; cell.dataset.col = c;
                    cell.onclick = () => handleChomp(r, c);
                    gridElement.appendChild(cell);
                }
            }
        }

        function handleChomp(r, c) {
            if (gameOver || (gameMode === 'PVC' && currentPlayer === 2)) return;
            const target = document.querySelector(`[data-row="${r}"][data-col="${c}"]`);
            if (target.classList.contains('eaten')) return;

            processMove(r, c);

            if (!gameOver && gameMode === 'PVC' && currentPlayer === 2) {
                statusElement.innerText = "ì»´í“¨í„°ê°€ ìƒê° ì¤‘...";
                setTimeout(proComputerTurn, 600);
            }
        }

        function processMove(row, col) {
            document.querySelectorAll('.cell').forEach(cell => {
                const r = parseInt(cell.dataset.row);
                const c = parseInt(cell.dataset.col);
                if (r <= row && c >= col) cell.classList.add('eaten');
            });

            if (row === ROWS - 1 && col === 0) {
                statusElement.innerText = (currentPlayer === 1 ? "ë‹¹ì‹ " : "ì»´í“¨í„°") + " íŒ¨ë°°! ğŸ’€";
                gameOver = true;
                return;
            }

            currentPlayer = currentPlayer === 1 ? 2 : 1;
            statusElement.innerText = (currentPlayer === 1 ? "ë‹¹ì‹ " : "ì»´í“¨í„°") + "ì˜ ì°¨ë¡€";
        }

        // --- AI ë¡œì§ ---
        function getBoardState() {
            let heights = new Array(COLS).fill(0);
            for (let c = 0; c < COLS; c++) {
                for (let r = 0; r < ROWS; r++) {
                    const cell = document.querySelector(`[data-row="${r}"][data-col="${c}"]`);
                    if (!cell.classList.contains('eaten')) {
                        heights[c] = ROWS - r;
                        break;
                    }
                }
            }
            return heights.join(',');
        }

        function canWin(stateStr) {
            if (stateStr === "1" + ",0".repeat(COLS-1)) return false;
            if (memo.has(stateStr)) return memo.get(stateStr);
            let heights = stateStr.split(',').map(Number);
            for (let c = 0; c < COLS; c++) {
                for (let h = 1; h <= heights[c]; h++) {
                    if (c === 0 && h === 1) continue;
                    let nextHeights = [...heights];
                    let r = ROWS - h;
                    for (let nc = c; nc < COLS; nc++) nextHeights[nc] = Math.min(nextHeights[nc], ROWS - r - 1);
                    if (!canWin(nextHeights.join(','))) {
                        memo.set(stateStr, {r: ROWS - h, c: c});
                        return {r: ROWS - h, c: c};
                    }
                }
            }
            memo.set(stateStr, false);
            return false;
        }

        function proComputerTurn() {
            const currentState = getBoardState();
            const bestMove = canWin(currentState);
            if (bestMove) processMove(bestMove.r, bestMove.c);
            else {
                const available = [];
                document.querySelectorAll('.cell:not(.eaten)').forEach(cell => {
                    const r = parseInt(cell.dataset.row);
                    const c = parseInt(cell.dataset.col);
                    if (r !== ROWS - 1 || c !== 0) available.push({r, c});
                });
                const choice = available.length > 0 ? available[0] : {r: ROWS-1, c: 0};
                processMove(choice.r, choice.c);
            }
        }

        function backToMenu() { menuElement.classList.remove('hidden'); gameArea.classList.add('hidden'); }
    </script>
</body>
</html>
