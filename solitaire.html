<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>브레인 비타 (개선판)</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #f0f0f0; margin-top: 50px; }
        #board { display: grid; grid-template-columns: repeat(7, 60px); grid-template-rows: repeat(7, 60px); gap: 8px; background: #6d4c41; padding: 15px; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .cell { width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; position: relative; }
        .invalid { background-color: transparent; pointer-events: none; }
        .hole { background-color: #3e2723; border: 2px solid #2d1d19; cursor: pointer; transition: 0.2s; }
        .peg { width: 45px; height: 45px; background: radial-gradient(circle at 30% 30%, #ffd54f, #f57f17); border-radius: 50%; pointer-events: none; box-shadow: 0 4px 5px rgba(0,0,0,0.4); }
        /* 선택된 상태 표시 */
        .selected { border: 3px solid #ff5252; transform: scale(1.1); box-shadow: 0 0 15px #ff5252; }
        #msg { margin-top: 25px; font-size: 1.2rem; font-weight: bold; color: #333; height: 30px; }
        button { margin-top: 20px; padding: 12px 25px; font-size: 1rem; border: none; border-radius: 5px; background: #5d4037; color: white; cursor: pointer; transition: 0.3s; }
        button:hover { background: #4e342e; }
    </style>
</head>
<body>
    <h1>영국식 페그 솔리테어</h1>
    <div id="board"></div>
    <div id="msg">말을 클릭하여 선택하세요!</div>
    <button onclick="initBoard()">다시 시작</button>

    <script>
        // 0: 공간없음, 1: 말 있음, 2: 빈 구멍
        let gameState = [
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [1,1,1,1,1,1,1],
            [1,1,1,2,1,1,1], // 중앙 비어있음
            [1,1,1,1,1,1,1],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0]
        ];

        let selectedPos = null;

        function initBoard() {
            gameState = [
                [0,0,1,1,1,0,0], [0,0,1,1,1,0,0], [1,1,1,1,1,1,1],
                [1,1,1,2,1,1,1], [1,1,1,1,1,1,1], [0,0,1,1,1,0,0], [0,0,1,1,1,0,0]
            ];
            selectedPos = null;
            render();
            updateMsg("게임을 시작합니다!");
        }

        function render() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            for(let r=0; r<7; r++) {
                for(let c=0; c<7; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    if (gameState[r][c] === 0) {
                        cell.classList.add('invalid');
                    } else {
                        cell.classList.add('hole');
                        if (gameState[r][c] === 1) {
                            const peg = document.createElement('div');
                            peg.className = 'peg';
                            if (selectedPos && selectedPos.r === r && selectedPos.c === c) {
                                peg.classList.add('selected');
                            }
                            cell.appendChild(peg);
                        }
                        cell.onclick = () => handleCellClick(r, c);
                    }
                    board.appendChild(cell);
                }
            }
            checkEndGame();
        }

        function handleCellClick(r, c) {
            if (gameState[r][c] === 1) { // 말을 선택한 경우
                selectedPos = {r, c};
                updateMsg("이동할 빈 칸을 선택하세요.");
                render();
            } else if (gameState[r][c] === 2 && selectedPos) { // 빈 칸을 선택한 경우
                const dr = r - selectedPos.r;
                const dc = c - selectedPos.c;

                // 2칸 이동 확인 (가로 또는 세로)
                if ((Math.abs(dr) === 2 && dc === 0) || (Math.abs(dc) === 2 && dr === 0)) {
                    const midR = (r + selectedPos.r) / 2;
                    const midC = (c + selectedPos.c) / 2;

                    if (gameState[midR][midC] === 1) { // 가운데 말이 있는지 확인
                        // 이동 실행
                        gameState[selectedPos.r][selectedPos.c] = 2; // 원래 자리 빈칸
                        gameState[midR][midC] = 2; // 건너뛴 말 제거
                        gameState[r][c] = 1; // 목표 자리 말 생성
                        selectedPos = null;
                        updateMsg("좋은 수입니다!");
                        render();
                    } else {
                        updateMsg("말을 건너뛰어야 합니다.");
                    }
                } else {
                    selectedPos = null;
                    updateMsg("두 칸만 이동할 수 있습니다.");
                    render();
                }
            }
        }

        function updateMsg(txt) {
            document.getElementById('msg').innerText = txt;
        }

        function checkEndGame() {
            let pegCount = 0;
            gameState.forEach(row => row.forEach(cell => { if(cell === 1) pegCount++; }));
            if (pegCount === 1) {
                if (gameState[3][3] === 1) updateMsg("완벽합니다! IQ 상위 1%!");
                else updateMsg("성공! 하나만 남았습니다.");
            }
        }

        initBoard();
    </script>
</body>
</html>